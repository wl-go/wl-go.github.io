<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://wl-go.github.io</id>
    <title>wlgo åšå®¢</title>
    <updated>2020-12-24T08:28:28.282Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://wl-go.github.io"/>
    <link rel="self" href="https://wl-go.github.io/atom.xml"/>
    <subtitle>è®°å½•å­¦ä¹ ä¸­çš„ç‚¹ç‚¹æ»´æ»´ï¼</subtitle>
    <logo>https://wl-go.github.io/images/avatar.png</logo>
    <icon>https://wl-go.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, wlgo åšå®¢</rights>
    <entry>
        <title type="html"><![CDATA[Android ä¸‰æ–¹åº“å­¦ä¹ ]]></title>
        <id>https://wl-go.github.io/post/android-san-fang-ku-xue-xi/</id>
        <link href="https://wl-go.github.io/post/android-san-fang-ku-xue-xi/">
        </link>
        <updated>2020-06-23T06:12:41.000Z</updated>
        <content type="html"><![CDATA[<h1 id="åŠ¨æ€æƒé™">åŠ¨æ€æƒé™</h1>
<h1 id="mpandroidchart">MPAndroidChart</h1>
<p><a href="https://weeklycoding.com/mpandroidchart/">æ–‡æ¡£</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Roomæ•°æ®åº“æ“ä½œ]]></title>
        <id>https://wl-go.github.io/post/room-shu-ju-ku-cao-zuo/</id>
        <link href="https://wl-go.github.io/post/room-shu-ju-ku-cao-zuo/">
        </link>
        <updated>2020-06-22T12:37:02.000Z</updated>
        <content type="html"><![CDATA[<h1 id="room">Room</h1>
<blockquote>
<p>RoomæŒä¹…æ€§åº“åœ¨ SQLite çš„åŸºç¡€ä¸Šæä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿåœ¨å……åˆ†åˆ©ç”¨ SQLite çš„å¼ºå¤§åŠŸèƒ½çš„åŒæ—¶ï¼Œè·äº«æ›´å¼ºå¥çš„æ•°æ®åº“è®¿é—®æœºåˆ¶ã€‚</p>
<p>å¤„ç†å¤§é‡ç»“æ„åŒ–æ•°æ®çš„åº”ç”¨å¯æå¤§åœ°å—ç›Šäºåœ¨æœ¬åœ°ä¿ç•™è¿™äº›æ•°æ®ã€‚æœ€å¸¸è§çš„ç”¨ä¾‹æ˜¯ <strong>ç¼“å­˜ç›¸å…³æ•°æ®</strong> ã€‚è¿™æ ·ï¼Œå½“è®¾å¤‡æ— æ³•è®¿é—®ç½‘ç»œæ—¶ï¼Œç”¨æˆ·ä»å¯åœ¨ç¦»çº¿çŠ¶æ€ä¸‹æµè§ˆç›¸åº”å†…å®¹ã€‚è®¾å¤‡ä¹‹åé‡æ–°è¿æ¥åˆ°ç½‘ç»œåï¼Œç”¨æˆ·å‘èµ·çš„æ‰€æœ‰å†…å®¹æ›´æ”¹éƒ½ä¼šåŒæ­¥åˆ°æœåŠ¡å™¨ã€‚</p>
</blockquote>
<h2 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–</h2>
<p><a href="https://developer.android.google.cn/jetpack/androidx/releases/room">Roomç‰ˆæœ¬</a></p>
<pre><code class="language-groovy">dependencies {
      def room_version = &quot;2.2.2&quot;

      implementation &quot;androidx.room:room-runtime:$room_version&quot;
      annotationProcessor &quot;androidx.room:room-compiler:$room_version&quot; 
      // For Kotlin use kapt instead of annotationProcessor
      // apply plugin: 'kotlin-kapt'

      // optional - Kotlin Extensions and Coroutines support for Room
      implementation &quot;androidx.room:room-ktx:$room_version&quot;

      // Test helpers
      testImplementation &quot;androidx.room:room-testing:$room_version&quot;
    }
</code></pre>
<p><strong>å¤‡æ³¨ï¼šAndroidStudio æ•°æ®åº“æµè§ˆå™¨æµ‹è¯•</strong></p>
<pre><code class="language-groovy">debugImplementation 'com.amitshekhar.android:debug-db:1.0.0'
</code></pre>
<h2 id="room-åŒ…å«-3-ä¸ªä¸»è¦ç»„ä»¶">Room åŒ…å« 3 ä¸ªä¸»è¦ç»„ä»¶ï¼š</h2>
<h3 id="database">Database</h3>
<blockquote>
<p>åŒ…å«æ•°æ®åº“æŒæœ‰è€…ï¼Œå¹¶ä½œä¸ºåº”ç”¨å·²ä¿ç•™çš„æŒä¹…å…³ç³»å‹æ•°æ®çš„åº•å±‚è¿æ¥çš„ä¸»è¦æ¥å…¥ç‚¹ã€‚</p>
</blockquote>
<ul>
<li>æ‰©å±• RoomDatabase çš„æŠ½è±¡ç±»</li>
<li>åœ¨æ³¨é‡Šä¸­æ·»åŠ ä¸æ•°æ®åº“å…³è”çš„å®ä½“åˆ—è¡¨</li>
<li>åŒ…å«å…·æœ‰ 0 ä¸ªå‚æ•°ä¸”è¿”å›ä½¿ç”¨ @Dao æ³¨é‡Šçš„ç±»çš„æŠ½è±¡æ–¹æ³•</li>
</ul>
<p><strong>å¤‡æ³¨: åœ¨è¿è¡Œæ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ Room.databaseBuilder() æˆ– Room.inMemoryDatabaseBuilder() è·å– Database çš„å®ä¾‹</strong></p>
<pre><code class="language-kotlin">@Database(entities = [Person::class], version = 1)
abstract class MyAppDatabase : RoomDatabase(){
    abstract fun personDao(): IPersonDao
    
    companion object {
    
            private const val databaseName = &quot;android-demo.db&quot; // æ•°æ®åº“åç§°ä¸€å®šè¦æœ‰.dbåç¼€
    
            @Volatile
            private var instance: MyAppDatabase? = null
    
            fun getInstance() =
                instance ?: synchronized(this) {
                    instance ?: Room.databaseBuilder(
                        MyApp.getInstance().applicationContext,
                        MyAppDatabase::
                        class.java,
                        databaseName
                    ).build().also {
                        instance = it
                    }
                }
        }
}
</code></pre>
<h3 id="entity">Entity</h3>
<blockquote>
<p>è¡¨ç¤ºæ•°æ®åº“ä¸­çš„è¡¨ã€‚</p>
</blockquote>
<br/>
<pre><code class="language-kotlin">@Entity
data class Person(
    @PrimaryKey val uid: Int,
    @ColumnInfo(name = &quot;p_name&quot;) val name: String,
    @ColumnInfo(name = &quot;p_age&quot;) val age: Int?
)
</code></pre>
<h3 id="dao">DAO</h3>
<blockquote>
<p>åŒ…å«ç”¨äºè®¿é—®æ•°æ®åº“çš„æ–¹æ³•ã€‚</p>
</blockquote>
<br/>
<pre><code class="language-kotlin">@Dao
interface IPersonDao {
    @Insert
    fun insert(p: Person)

    @Query(&quot;SELECT * FROM PERSON&quot;)
    fun getAll():List&lt;Person&gt;
}
</code></pre>
<p><strong>å¤‡æ³¨: åº”ç”¨ä½¿ç”¨ Room æ•°æ®åº“æ¥è·å–ä¸è¯¥æ•°æ®åº“å…³è”çš„æ•°æ®è®¿é—®å¯¹è±¡ (DAO)ã€‚ç„¶åï¼Œåº”ç”¨ä½¿ç”¨æ¯ä¸ª DAO ä»æ•°æ®åº“ä¸­è·å–å®ä½“ï¼Œç„¶åå†å°†å¯¹è¿™äº›å®ä½“çš„æ‰€æœ‰æ›´æ”¹ä¿å­˜å›æ•°æ®åº“ä¸­ã€‚æœ€åï¼Œåº”ç”¨ä½¿ç”¨å®ä½“æ¥è·å–å’Œè®¾ç½®ä¸æ•°æ®åº“ä¸­çš„è¡¨åˆ—ç›¸å¯¹åº”çš„å€¼ã€‚</strong></p>
<p><strong>æ³¨æ„ï¼šå¦‚æœæ‚¨çš„åº”ç”¨åœ¨å•ä¸ªè¿›ç¨‹ä¸­è¿è¡Œï¼Œåˆ™åœ¨å®ä¾‹åŒ– AppDatabase å¯¹è±¡æ—¶åº”éµå¾ªå•ä¾‹è®¾è®¡æ¨¡å¼ã€‚æ¯ä¸ª RoomDatabase å®ä¾‹çš„æˆæœ¬ç›¸å½“é«˜ï¼Œè€Œæ‚¨å‡ ä¹ä¸éœ€è¦åœ¨å•ä¸ªè¿›ç¨‹ä¸­è®¿é—®å¤šä¸ªå®ä¾‹ã€‚<br>
å¦‚æœæ‚¨çš„åº”ç”¨åœ¨å¤šä¸ªè¿›ç¨‹ä¸­è¿è¡Œï¼Œè¯·åœ¨æ•°æ®åº“æ„å»ºå™¨è°ƒç”¨ä¸­åŒ…å« enableMultiInstanceInvalidation()ã€‚è¿™æ ·ï¼Œå¦‚æœæ‚¨åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­éƒ½æœ‰ä¸€ä¸ª AppDatabase å®ä¾‹ï¼Œå°±å¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ä½¿å…±äº«æ•°æ®åº“æ–‡ä»¶å¤±æ•ˆï¼Œå¹¶ä¸”è¿™ç§å¤±æ•ˆä¼šè‡ªåŠ¨ä¼ æ’­åˆ°å…¶ä»–è¿›ç¨‹ä¸­çš„ AppDatabase å®ä¾‹ã€‚</strong></p>
<h2 id="ä½¿ç”¨roomå®ä½“å®šä¹‰æ•°æ®entity">ä½¿ç”¨Roomå®ä½“å®šä¹‰æ•°æ®ï¼ˆ@Entityï¼‰</h2>
<blockquote>
<p>å°†ç›¸å…³å­—æ®µé›†å®šä¹‰åœ¨å®ä½“ä¸­ï¼Œå¯¹äºæ¯ä¸ªå®ä½“ï¼Œç³»ç»Ÿä¼šåœ¨å…³è”çš„Databaseå¯¹è±¡ä¸­åˆ›å»ºä¸€ä¸ªè¡¨æ¥å­˜å‚¨è¿™ä¸ªé¡¹ï¼Œ<strong>é€šè¿‡Databaseä¸­entitiesæ•°ç»„å¼•ç”¨å®ä½“ç±»</strong></p>
</blockquote>
<h3 id="entityä¸­å„æ³¨è§£ç†è§£åŠä½¿ç”¨">Entityä¸­å„æ³¨è§£ç†è§£åŠä½¿ç”¨</h3>
<blockquote>
<p><strong>æ¯ä¸ªå®ä½“å¿…é¡»å°†è‡³å°‘ 1 ä¸ªå­—æ®µå®šä¹‰ä¸ºä¸»é”®ã€‚å³ä½¿åªæœ‰ 1 ä¸ªå­—æ®µï¼Œæ‚¨ä»ç„¶éœ€è¦ä¸ºè¯¥å­—æ®µæ·»åŠ  @PrimaryKey æ³¨é‡Šã€‚</strong> æ­¤å¤–ï¼Œå¦‚æœæ‚¨æƒ³è®© Room ä¸º<strong>å®ä½“åˆ†é…è‡ªåŠ¨ ID</strong>ï¼Œåˆ™å¯ä»¥è®¾ç½® <strong>@PrimaryKey çš„ autoGenerate å±æ€§</strong>ã€‚å¦‚æœå®ä½“å…·æœ‰å¤åˆä¸»é”®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ @Entity æ³¨é‡Šçš„ primaryKeys å±æ€§</p>
</blockquote>
<pre><code class="language-kotlin">@Entity
data class Person(
    @PrimaryKey val uid: String,
    @ColumnInfo(name = &quot;p_name&quot;) val name: String,
    @ColumnInfo(name = &quot;p_age&quot;) val age: Int?,
    @ColumnInfo(name = &quot;p_phone&quot;) val phone: String?
)
</code></pre>
<ul>
<li>
<p>@Entityå±æ€§è®¾ç½®</p>
<ol>
<li>tableName // å®šä¹‰æ•°æ®åº“è¡¨åç§°ï¼Œ<strong>Room å°†ç±»åç§°ç”¨ä½œæ•°æ®åº“è¡¨åç§°</strong></li>
<li>indices</li>
<li>inheritSuperIndices</li>
<li>primaryKeys  // ä¸»é”®</li>
<li>foreignKeys // å‰¯å¥</li>
<li>ignoredColumns // è¿‡æ»¤å­—æ®µï¼Œä¸ä¼šå‡ºç°åœ¨æ•°æ®åº“è¡¨ä¸­ï¼ˆç”¨äºç»§æ‰¿å…³ç³»å¿½ç•¥å­—æ®µï¼‰, ä¹Ÿå¯ä»¥é€šè¿‡@Ignoreæ³¨è§£ç±»å­—æ®µ<pre><code class="language-kotlin">   open class A{
       val p:Bitmap? = null
   }
   // @Entity(ignoredColumns = arrayof(&quot;p&quot;))
   // data .....

</code></pre>
</li>
</ol>
</li>
<li>
<p>@PrimaryKeyå±æ€§è®¾ç½®</p>
<ol>
<li>autoGenerate // æ˜¯å¦ä¸ºè‡ªåŠ¨å¢é•¿</li>
</ol>
</li>
<li>
<p>@ColumnInfoå±æ€§è®¾ç½®</p>
<ol>
<li>name // å®šä¹‰è¡¨å­—æ®µåç§°ï¼Œ<strong>é»˜è®¤å®ä½“å­—æ®µå</strong></li>
<li>typeAffinity</li>
<li>index    // å¦‚æœåº”ä¸ºè¯¥å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œåˆ™ä¸ºTrueï¼Œå¦åˆ™ä¸ºfalseã€‚ é»˜è®¤ä¸ºfalseã€‚</li>
<li>collate  // åˆ—çš„æ’åºè§„åˆ™åºåˆ—</li>
<li>defaultValue //</li>
</ol>
</li>
</ul>
<h2 id="å®šä¹‰å¯¹è±¡ä¹‹é—´çš„å…³ç³»">å®šä¹‰å¯¹è±¡ä¹‹é—´çš„å…³ç³»</h2>
<blockquote>
<p>ç”±äº SQLite æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œå› æ­¤å¯ä»¥æŒ‡å®šå„ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚å°½ç®¡å¤§å¤šæ•°å¯¹è±¡å…³ç³»æ˜ å°„åº“éƒ½å…è®¸å®ä½“å¯¹è±¡äº’ç›¸å¼•ç”¨ï¼Œ<strong>ä½† Room æ˜ç¡®ç¦æ­¢è¿™æ ·åš</strong>ã€‚</p>
</blockquote>
<h3 id="å®šä¹‰ä¸€å¯¹å¤šå…³ç³»">å®šä¹‰ä¸€å¯¹å¤šå…³ç³»</h3>
<pre><code class="language-kotlin">@Entity(
    primaryKeys = [&quot;id&quot;],
    // è®¾ç½®å‰¯é”®
    foreignKeys = [ForeignKey(
        entity = Person::class,
        parentColumns = [&quot;uid&quot;],
        childColumns = [&quot;user_id&quot;],
        onDelete = ForeignKey.CASCADE // è¿™ä¸ªè¡¨ç¤ºï¼Œå¯¹åº”çš„Personåˆ é™¤äº†ï¼Œä¹Ÿè¿å¸¦åˆ é™¤Personä¸‹çš„æ‰€æœ‰ä¹¦ç±
    )]
)
data class Book(
    val id: String,
    val user_id: String?,
    val b_name: String?
)
</code></pre>
<h3 id="åˆ›å»ºåµŒå¥—å¯¹è±¡">åˆ›å»ºåµŒå¥—å¯¹è±¡</h3>
<blockquote>
<p>ä½¿ç”¨ @Embedded æ³¨é‡Šè¡¨ç¤ºè¦è§£æ„åˆ°è¡¨ä¸­å…¶å­å­—æ®µçš„å¯¹è±¡ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥åƒæŸ¥è¯¢å…¶ä»–å„ä¸ªåˆ—ä¸€æ ·æŸ¥è¯¢åµŒå¥—å­—æ®µã€‚<br>
ä¾‹å¦‚ï¼Œæ‚¨çš„ User ç±»å¯ä»¥åŒ…å«ç±»å‹ Address çš„å­—æ®µï¼Œè¯¥ç±»å‹è¡¨ç¤ºä¸€ç»„åˆ†åˆ«åä¸º streetã€cityã€state å’Œ postCode çš„å­—æ®µã€‚è¦åœ¨è¡¨ä¸­å•ç‹¬å­˜å‚¨ç»„æˆçš„åˆ—ï¼Œè¯·åœ¨ User ç±»ï¼ˆä½¿ç”¨ @Embedded æ³¨é‡Šï¼‰ä¸­æ·»åŠ  Address å­—æ®µï¼Œå¦‚ä»¥ä¸‹ä»£ç æ®µæ‰€ç¤ºï¼š</p>
</blockquote>
<pre><code class="language-kotlin">    data class Address(
        val street: String?,
        val state: String?,
        val city: String?,
        @ColumnInfo(name = &quot;post_code&quot;) val postCode: Int
    )

    @Entity
    data class User(
        @PrimaryKey val id: Int,
        val firstName: String?,
        @Embedded val address: Address?
    )
</code></pre>
<p>å¤‡æ³¨: è¡¨ç¤º User å¯¹è±¡çš„è¡¨ä¼šåŒ…å«å…·æœ‰ä»¥ä¸‹åç§°çš„åˆ—ï¼šidã€firstNameã€streetã€stateã€city å’Œ post_codeã€‚</p>
<p>æ³¨æ„ï¼šåµŒå¥—å­—æ®µè¿˜å¯ä»¥åŒ…å«å…¶ä»–åµŒå¥—å­—æ®µï¼Œå¦‚æœæŸä¸ªå®ä½“å…·æœ‰åŒä¸€ç±»å‹çš„å¤šä¸ªåµŒå¥—å­—æ®µï¼Œæ‚¨å¯ä»¥é€šè¿‡<strong>è®¾ç½® prefix</strong> å±æ€§ç¡®ä¿æ¯ä¸ªåˆ—éƒ½ç‹¬ä¸€æ— äºŒã€‚ç„¶åï¼ŒRoom ä¼šå°†æä¾›çš„å€¼æ·»åŠ åˆ°åµŒå¥—å¯¹è±¡ä¸­æ¯ä¸ªåˆ—åç§°çš„å¼€å¤´ã€‚</p>
<h3 id="å®šä¹‰å¤šå¯¹å¤šå…³ç³»">å®šä¹‰å¤šå¯¹å¤šå…³ç³»</h3>
<blockquote>
<p>æ‚¨é€šå¸¸å¸Œæœ›åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­æ„å»ºçš„å¦ä¸€ç§å…³ç³»æ¨¡å‹æ˜¯ä¸¤ä¸ªå®ä½“ä¹‹é—´çš„å¤šå¯¹å¤šå…³ç³»ï¼Œå…¶ä¸­æ¯ä¸ªå®ä½“éƒ½å¯ä»¥å…³è”åˆ°å¦ä¸€ä¸ªå®ä½“çš„é›¶ä¸ªæˆ–æ›´å¤šä¸ªå®ä¾‹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªéŸ³ä¹åœ¨çº¿æ’­æ”¾åº”ç”¨ï¼Œç”¨æˆ·å¯ä»¥åœ¨è¯¥åº”ç”¨ä¸­å°†è‡ªå·±å–œçˆ±çš„æ­Œæ›²æ•´ç†åˆ°æ’­æ”¾åˆ—è¡¨ä¸­ã€‚æ¯ä¸ªæ’­æ”¾åˆ—è¡¨éƒ½å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„æ­Œæ›²ï¼Œæ¯é¦–æ­Œæ›²éƒ½å¯ä»¥åŒ…å«åœ¨ä»»æ„æ•°é‡çš„æ’­æ”¾åˆ—è¡¨ä¸­ã€‚</p>
</blockquote>
<p>è¦æ„å»ºè¿™ç§å…³ç³»çš„æ¨¡å‹ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸‹é¢ä¸‰ä¸ªå¯¹è±¡ï¼š</p>
<ul>
<li>æ’­æ”¾åˆ—è¡¨çš„å®ä½“ç±»ã€‚</li>
<li>æ­Œæ›²çš„å®ä½“ç±»ã€‚</li>
<li>ç”¨äºä¿å­˜æ¯ä¸ªæ’­æ”¾åˆ—è¡¨ä¸­çš„æ­Œæ›²ç›¸å…³ä¿¡æ¯çš„ä¸­é—´ç±»ã€‚</li>
</ul>
<ol>
<li>å°†å®ä½“ç±»å®šä¹‰ä¸ºç‹¬ç«‹å•å…ƒï¼š</li>
</ol>
<pre><code class="language-kotlin">    @Entity
    data class Playlist(
        @PrimaryKey var id: Int,
        val name: String?,
        val description: String?
    )

    @Entity
    data class Song(
        @PrimaryKey var id: Int,
        val songName: String?,
        val artistName: String?
    )
</code></pre>
<ol start="2">
<li>ä¸­é—´ç±»å®šä¹‰ä¸ºåŒ…å«å¯¹ Song å’Œ Playlist çš„å¤–é”®å¼•ç”¨çš„å®ä½“ï¼š</li>
</ol>
<pre><code class="language-kotlin">    @Entity(tableName = &quot;playlist_song_join&quot;,
            primaryKeys = arrayOf(&quot;playlistId&quot;,&quot;songId&quot;),
            foreignKeys = arrayOf(
                             ForeignKey(entity = Playlist::class,
                                        parentColumns = arrayOf(&quot;id&quot;),
                                        childColumns = arrayOf(&quot;playlistId&quot;)),
                             ForeignKey(entity = Song::class,
                                        parentColumns = arrayOf(&quot;id&quot;),
                                        childColumns = arrayOf(&quot;songId&quot;))
                                  )
            )
    data class PlaylistSongJoin(
        val playlistId: Int,
        val songId: Int
    )
</code></pre>
<ol start="3">
<li>å€ŸåŠ©è¯¥æ¨¡å‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ DAO æŒ‰æ­Œæ›²æŸ¥è¯¢æ’­æ”¾åˆ—è¡¨å’ŒæŒ‰æ’­æ”¾åˆ—è¡¨æŸ¥è¯¢æ­Œæ›²ï¼š</li>
</ol>
<pre><code class="language-kotlin">    @Dao
    interface PlaylistSongJoinDao {
        @Insert
        fun insert(playlistSongJoin: PlaylistSongJoin)

        @Query(&quot;&quot;&quot;
               SELECT * FROM playlist
               INNER JOIN playlist_song_join
               ON playlist.id=playlist_song_join.playlistId
               WHERE playlist_song_join.songId=:songId
               &quot;&quot;&quot;)
        fun getPlaylistsForSong(songId: Int): Array&lt;Playlist&gt;

        @Query(&quot;&quot;&quot;
               SELECT * FROM song
               INNER JOIN playlist_song_join
               ON song.id=playlist_song_join.songId
               WHERE playlist_song_join.playlistId=:playlistId
               &quot;&quot;&quot;)
        fun getSongsForPlaylist(playlistId: Int): Array&lt;Song&gt;
    }
</code></pre>
<h2 id="åˆ›å»ºè§†å›¾">åˆ›å»ºè§†å›¾</h2>
<blockquote>
<p>å°†æŸ¥è¯¢å°è£…åˆ°ç±»ä¸­ï¼ŒRoom å°†è¿™äº›æŸ¥è¯¢æ”¯æŒçš„ç±»ç§°ä¸ºè§†å›¾ï¼Œåœ¨ DAO ä¸­ä½¿ç”¨æ—¶ï¼Œå®ƒä»¬çš„è¡Œä¸ºä¸ç®€å•æ•°æ®å¯¹è±¡çš„è¡Œä¸ºç›¸åŒã€‚</p>
</blockquote>
<p><strong>æ³¨æ„ï¼šä¸å®ä½“ç±»ä¼¼ï¼Œæ‚¨å¯ä»¥é’ˆå¯¹è§†å›¾è¿è¡Œ SELECT è¯­å¥ã€‚ä¸è¿‡ï¼Œæ‚¨æ— æ³•é’ˆå¯¹è§†å›¾è¿è¡Œ INSERTã€UPDATE æˆ– DELETE è¯­å¥ã€‚</strong></p>
<h3 id="åˆ›å»ºè§†å›¾-databaseview">åˆ›å»ºè§†å›¾ @DatabaseView</h3>
<pre><code class="language-kotlin">    @DatabaseView(&quot;SELECT user.id, user.name, user.departmentId,&quot; +
            &quot;department.name AS departmentName FROM user &quot; +
            &quot;INNER JOIN department ON user.departmentId = department.id&quot;)
    data class UserDetail(
        val id: Long,
        val name: String?,
        val departmentId: Long,
        val departmentName: String?
    )
</code></pre>
<h3 id="å°†è§†å›¾ä¸æ•°æ®åº“ç›¸å…³è”">å°†è§†å›¾ä¸æ•°æ®åº“ç›¸å…³è”</h3>
<blockquote>
<p>è¦å°†æ­¤è§†å›¾æ·»åŠ ä¸ºåº”ç”¨æ•°æ®åº“çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨åº”ç”¨çš„ @Database æ³¨é‡Šä¸­æ·»åŠ  <strong>views</strong> å±æ€§ï¼š</p>
</blockquote>
<br/>
<pre><code class="language-kotlin">    @Database(entities = arrayOf(User::class),
              views = arrayOf(UserDetail::class), version = 1)
    abstract class AppDatabase : RoomDatabase() {
        abstract fun userDao(): UserDao
    }
</code></pre>
<h3 id="ä½¿ç”¨è§†å›¾æŸ¥è¯¢">ä½¿ç”¨è§†å›¾æŸ¥è¯¢</h3>
<pre><code class="language-kotlin"> @Query(&quot;SELECT * FROM PersonBookJoin&quot;) // PersonBookJoinå°±æ˜¯åˆ›å»ºçš„è§†å›¾
 fun getInfoByView(): List&lt;PersonBookJoin&gt;
</code></pre>
<h2 id="ä½¿ç”¨-room-dao-è®¿é—®æ•°æ®">ä½¿ç”¨ Room DAO è®¿é—®æ•°æ®</h2>
<blockquote>
<p>DAO æ•°æ®è®¿é—®å¯¹è±¡ï¼Œæ¯ä¸ªDAOéƒ½åŒ…å«äº†ä¸€äº›æ–¹æ³•ï¼Œæä¾›äº†å¯¹åº”ç”¨æ•°æ®åº“çš„æŠ½è±¡è®¿é—®æƒé™</p>
</blockquote>
<p><strong>æ³¨æ„ï¼šé™¤éæ‚¨å¯¹æ„å»ºå™¨è°ƒç”¨ allowMainThreadQueries()ï¼Œå¦åˆ™ Room ä¸æ”¯æŒåœ¨ä¸»çº¿ç¨‹ä¸Šè®¿é—®æ•°æ®åº“ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šé•¿æ—¶é—´é”å®šç•Œé¢ã€‚å¼‚æ­¥æŸ¥è¯¢ï¼ˆè¿”å› LiveData æˆ– Flowable å®ä¾‹çš„æŸ¥è¯¢ï¼‰æ— éœ€éµå®ˆæ­¤è§„åˆ™ï¼Œå› ä¸ºæ­¤ç±»æŸ¥è¯¢ä¼šæ ¹æ®éœ€è¦åœ¨åå°çº¿ç¨‹ä¸Šå¼‚æ­¥è¿è¡ŒæŸ¥è¯¢ã€‚</strong></p>
<h3 id="insert">Insert</h3>
<blockquote>
<p>å½“åˆ›å»º DAO æ–¹æ³•å¹¶ä½¿ç”¨ @Insert å¯¹å…¶è¿›è¡Œæ³¨é‡Šæ—¶ï¼ŒRoom ä¼šç”Ÿæˆä¸€ä¸ªå®ç°ï¼Œè¯¥å®ç°åœ¨<strong>å•ä¸ªäº‹åŠ¡</strong>ä¸­å°†æ‰€æœ‰å‚æ•°æ’å…¥åˆ°æ•°æ®åº“ä¸­ã€‚</p>
</blockquote>
<p><strong>å¤‡æ³¨: å¦‚æœ @Insert æ–¹æ³•åªæ¥æ”¶ 1 ä¸ªå‚æ•°ï¼Œåˆ™å¯è¿”å› <code>long</code> ï¼Œè¿™æ˜¯æ’å…¥é¡¹çš„æ–° rowIdã€‚å¦‚æœå‚æ•°æ˜¯æ•°ç»„æˆ–é›†åˆï¼Œåˆ™åº”è¿”å› <code>long[]</code> æˆ– <code>List&lt;Long&gt;</code>ã€‚</strong></p>
<ul>
<li>
<p>entity</p>
</li>
<li>
<p>onConflict<br>
å¦‚æœå‘ç”Ÿå†²çªè¯¥æ€ä¹ˆåŠ<br>
ä½¿ç”¨{@link OnConflictStrategyï¼ƒABORT}ï¼ˆé»˜è®¤ï¼‰åœ¨å‘ç”Ÿå†²çªæ—¶å›æ»šäº‹åŠ¡ã€‚<br>
ä½¿ç”¨{@link OnConflictStrategyï¼ƒREPLACE}å°†ç°æœ‰è¡Œæ›¿æ¢ä¸ºæ–°è¡Œã€‚<br>
ä½¿ç”¨{@link OnConflictStrategyï¼ƒIGNORE}ä¿ç•™ç°æœ‰è¡Œã€‚<br>
@returnå¦‚ä½•å¤„ç†å†²çªã€‚ é»˜è®¤ä¸º{@link OnConflictStrategyï¼ƒABORT}ã€‚</p>
</li>
</ul>
<h3 id="update">Update</h3>
<blockquote>
<p>Update ä¾¿æ·æ–¹æ³•ä¼šä¿®æ”¹æ•°æ®åº“ä¸­ä»¥å‚æ•°å½¢å¼ç»™å‡ºçš„ä¸€ç»„å®ä½“ã€‚å®ƒä½¿ç”¨ä¸<code>æ¯ä¸ªå®ä½“çš„ä¸»é”®åŒ¹é…çš„æŸ¥è¯¢</code>ã€‚</p>
</blockquote>
<pre><code class="language-kotlin">    @Dao
    interface MyDao {
        @Update
        fun updateUsers(vararg users: User)
    }
</code></pre>
<p><strong>å¤‡æ³¨:å¯ä»¥è®©æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ª<code>int</code>å€¼ï¼Œè¡¨ç¤ºæ•°æ®åº“ä¸­<code>æ›´æ–°çš„è¡Œæ•°</code>ã€‚</strong></p>
<h3 id="delete">Delete</h3>
<blockquote>
<p>Delete ä¾¿æ·æ–¹æ³•ä¼šä»æ•°æ®åº“ä¸­åˆ é™¤ä¸€ç»„ä»¥å‚æ•°å½¢å¼ç»™å‡ºçš„å®ä½“ã€‚å®ƒä½¿ç”¨<code>ä¸»é”®æŸ¥æ‰¾è¦åˆ é™¤çš„å®ä½“</code>ã€‚</p>
</blockquote>
<pre><code class="language-kotlin">    @Dao
    interface MyDao {
        @Delete
        fun deleteUsers(vararg users: User)
    }
</code></pre>
<p><strong>å¤‡æ³¨:æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ª<code>int</code>å€¼ï¼Œè¡¨ç¤ºä»æ•°æ®åº“ä¸­<code>åˆ é™¤çš„è¡Œæ•°</code>ã€‚</strong></p>
<h3 id="query-query">Query ï¼ˆ@Queryï¼‰</h3>
<blockquote>
<p>@Query æ˜¯ DAO ç±»ä¸­ä½¿ç”¨çš„ä¸»è¦æ³¨é‡Šã€‚<br>
å®ƒå…è®¸æ‚¨å¯¹æ•°æ®åº“<code>æ‰§è¡Œè¯»/å†™æ“ä½œ</code>ã€‚<br>
æ¯ä¸ª @Query æ–¹æ³•éƒ½ä¼šåœ¨ç¼–è¯‘æ—¶è¿›è¡ŒéªŒè¯ï¼Œå› æ­¤å¦‚æœæŸ¥è¯¢å‡ºç°é—®é¢˜ï¼Œåˆ™ä¼šå‘ç”Ÿç¼–è¯‘é”™è¯¯ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶å¤±è´¥ã€‚<br>
Room è¿˜ä¼šéªŒè¯æŸ¥è¯¢çš„è¿”å›å€¼ï¼Œè¿™æ ·çš„è¯ï¼Œå½“è¿”å›çš„å¯¹è±¡ä¸­çš„å­—æ®µåç§°ä¸æŸ¥è¯¢å“åº”ä¸­çš„å¯¹åº”åˆ—åç§°ä¸åŒ¹é…æ—¶ï¼ŒRoom ä¼šé€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€æé†’ï¼š<br>
å¦‚æœåªæœ‰éƒ¨åˆ†å­—æ®µåç§°åŒ¹é…ï¼Œåˆ™ä¼šå‘å‡ºè­¦å‘Šã€‚<br>
å¦‚æœæ²¡æœ‰ä»»ä½•å­—æ®µåç§°åŒ¹é…ï¼Œåˆ™ä¼šå‘å‡ºé”™è¯¯ã€‚</p>
</blockquote>
<h4 id="ç®€å•æŸ¥è¯¢">ç®€å•æŸ¥è¯¢</h4>
<pre><code class="language-kotlin">    @Dao
    interface MyDao {
        @Query(&quot;SELECT * FROM user&quot;)
        fun loadAllUsers(): Array&lt;User&gt;
    }
</code></pre>
<h4 id="å°†å‚æ•°ä¼ é€’ç»™æŸ¥è¯¢">å°†å‚æ•°ä¼ é€’ç»™æŸ¥è¯¢</h4>
<pre><code class="language-kotlin">    @Dao
    interface MyDao {
        @Query(&quot;SELECT * FROM user WHERE age &gt; :minAge&quot;)
        fun loadAllUsersOlderThan(minAge: Int): Array&lt;User&gt;
    }
</code></pre>
<h4 id="è¿”å›åˆ—çš„å­é›†">è¿”å›åˆ—çš„å­é›†</h4>
<pre><code class="language-kotlin">    // è¿”å›æŸ¥è¯¢çš„å­é›†
    data class NameTuple(
        @ColumnInfo(name = &quot;first_name&quot;) val firstName: String?,
        @ColumnInfo(name = &quot;last_name&quot;) val lastName: String?
    )
    
    @Dao
    interface MyDao {
        @Query(&quot;SELECT first_name, last_name FROM user&quot;)
        fun loadFullName(): List&lt;NameTuple&gt;
    }
</code></pre>
<p><strong>å¤‡æ³¨: è¿™äº› POJO ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>@Embedded</code> æ³¨é‡Šã€‚</strong></p>
<h4 id="ä¼ é€’å‚æ•°çš„é›†åˆ">ä¼ é€’å‚æ•°çš„é›†åˆ</h4>
<blockquote>
<p>Room çŸ¥é“å‚æ•°ä½•æ—¶è¡¨ç¤ºé›†åˆï¼Œå¹¶æ ¹æ®æä¾›çš„å‚æ•°æ•°é‡åœ¨è¿è¡Œæ—¶è‡ªåŠ¨å°†å…¶å±•å¼€ã€‚</p>
</blockquote>
<pre><code class="language-kotlin">    @Dao
    interface MyDao {
        @Query(&quot;SELECT first_name, last_name FROM user WHERE region IN (:regions)&quot;)
        fun loadUsersFromRegions(regions: List&lt;String&gt;): List&lt;NameTuple&gt;
    }
</code></pre>
<h4 id="å¯è§‚å¯ŸæŸ¥è¯¢">å¯è§‚å¯ŸæŸ¥è¯¢</h4>
<blockquote>
<p>æ‰§è¡ŒæŸ¥è¯¢æ—¶ï¼Œæ‚¨é€šå¸¸ä¼šå¸Œæœ›åº”ç”¨çš„ç•Œé¢åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°ã€‚å¯ä»¥ä½¿ç”¨ LiveData ç±»å‹çš„è¿”å›å€¼ã€‚<code>å½“æ•°æ®åº“æ›´æ–°æ—¶ï¼ŒRoom ä¼šç”Ÿæˆæ›´æ–° LiveData æ‰€å¿…éœ€çš„æ‰€æœ‰ä»£ç ã€‚</code></p>
</blockquote>
<p><strong>æ³¨æ„: è‡ªç‰ˆæœ¬ 1.0 èµ·ï¼Œ<code>Room ä¼šæ ¹æ®åœ¨æŸ¥è¯¢ä¸­è®¿é—®çš„è¡¨æ ¼åˆ—è¡¨å†³å®šæ˜¯å¦æ›´æ–° LiveData å®ä¾‹ã€‚</code></strong></p>
<h4 id="æŸ¥è¯¢å¤šä¸ªè¡¨æ ¼">æŸ¥è¯¢å¤šä¸ªè¡¨æ ¼</h4>
<blockquote>
<p>å€ŸåŠ© Roomï¼Œå¯ä»¥ç¼–å†™ä»»ä½•æŸ¥è¯¢ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è”æ¥è¡¨æ ¼ã€‚æ­¤å¤–ï¼Œå¦‚æœå“åº”æ˜¯å¯è§‚å¯Ÿæ•°æ®ç±»å‹ï¼ˆå¦‚ Flowable æˆ– LiveDataï¼‰ï¼Œ<code>Room ä¼šè§‚å¯ŸæŸ¥è¯¢ä¸­å¼•ç”¨çš„æ‰€æœ‰è¡¨æ ¼ï¼Œä»¥ç¡®å®šæ˜¯å¦å­˜åœ¨æ— æ•ˆè¡¨æ ¼ã€‚</code></p>
</blockquote>
<pre><code class="language-kotlin">    @Dao
    interface MyDao {
        @Query(
            &quot;SELECT * FROM book &quot; +
            &quot;INNER JOIN loan ON loan.book_id = book.id &quot; +
            &quot;INNER JOIN user ON user.id = loan.user_id &quot; +
            &quot;WHERE user.name LIKE :userName&quot;
        )
        fun findBooksBorrowedByNameSync(userName: String): List&lt;Book&gt;
    }
</code></pre>
<h4 id="ä½¿ç”¨-kotlin-åç¨‹ç¼–å†™å¼‚æ­¥æ–¹æ³•">ä½¿ç”¨ Kotlin åç¨‹ç¼–å†™å¼‚æ­¥æ–¹æ³•</h4>
<blockquote>
<p>å¯ä»¥å°† <code>suspend</code> Kotlin å…³é”®å­—æ·»åŠ åˆ° <code>DAO æ–¹æ³•</code>ï¼Œä»¥ä½¿ç”¨ Kotlin åç¨‹åŠŸèƒ½ä½¿è¿™äº›æ–¹æ³•æˆä¸º<code>å¼‚æ­¥æ–¹æ³•</code>ã€‚è¿™æ ·å¯ç¡®ä¿ä¸ä¼šåœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œè¿™äº›æ–¹æ³•ã€‚</p>
</blockquote>
<h2 id="å¡«å……æ•°æ®åº“"><a href="https://developer.android.google.cn/training/data-storage/room/prepopulate">å¡«å……æ•°æ®åº“</a></h2>
<h2 id="è¿ç§»-room-æ•°æ®åº“">è¿ç§» Room æ•°æ®åº“</h2>
<blockquote>
<p>å½“åº”ç”¨ä¸­æ·»åŠ å’Œæ›´æ”¹åŠŸèƒ½æ—¶ï¼Œéœ€è¦ä¿®æ”¹å®ä½“ç±»ä»¥åæ˜ è¿™äº›æ›´æ”¹ã€‚å½“ç”¨æˆ·æ›´æ–°åº”ç”¨çš„æœ€æ–°ç‰ˆæœ¬æ—¶ï¼Œä¸æƒ³è®©ä»–ä»¬ä¸¢å¤±æ‰€æœ‰ç°æœ‰æ•°æ®ï¼Œå°¤å…¶æ˜¯åœ¨æ— æ³•ä»è¿œç¨‹æœåŠ¡å™¨æ¢å¤æ•°æ®æ—¶ã€‚<br>
å€ŸåŠ© Room æŒä¹…æ€§åº“ï¼Œæ‚¨å¯ä»¥ç¼–å†™ <code>Migration</code> ç±»ï¼Œä»¥è¿™ç§æ–¹å¼ä¿ç•™ç”¨æˆ·æ•°æ®ã€‚æ¯ä¸ª Migration ç±»å‡æŒ‡å®šä¸€ä¸ª <code>startVersion</code> å’Œ <code>endVersion</code>ã€‚<br>
åœ¨è¿è¡Œæ—¶ï¼ŒRoom ä¼šè¿è¡Œæ¯ä¸ª Migration ç±»çš„ <code>migrate()</code> æ–¹æ³•ï¼Œä»¥æŒ‰ç…§æ­£ç¡®çš„é¡ºåºå°†æ•°æ®åº“è¿ç§»åˆ°æ›´é«˜ç‰ˆæœ¬ã€‚</p>
</blockquote>
<pre><code class="language-kotlin">    val MIGRATION_1_2 = object : Migration(1, 2) {
        override fun migrate(database: SupportSQLiteDatabase) {
            database.execSQL(&quot;CREATE TABLE `Fruit` (`id` INTEGER, `name` TEXT, &quot; +
                    &quot;PRIMARY KEY(`id`))&quot;)
        }
    }

    val MIGRATION_2_3 = object : Migration(2, 3) {
        override fun migrate(database: SupportSQLiteDatabase) {
            database.execSQL(&quot;ALTER TABLE Book ADD COLUMN pub_year INTEGER&quot;)
        }
    }

    Room.databaseBuilder(applicationContext, MyDb::class.java, &quot;database-name&quot;)
            .addMigrations(MIGRATION_1_2, MIGRATION_2_3).build()
</code></pre>
<h3 id="å¦¥å–„å¤„ç†ç¼ºå¤±çš„è¿ç§»è·¯å¾„">å¦¥å–„å¤„ç†ç¼ºå¤±çš„è¿ç§»è·¯å¾„</h3>
<blockquote>
<p>æ›´æ–°æ•°æ®åº“çš„æ¶æ„åï¼Œéƒ¨åˆ†è®¾å¤‡ä¸Šçš„æ•°æ®åº“å¯èƒ½ä»ä¼šä½¿ç”¨è¾ƒä½ç‰ˆæœ¬çš„æ¶æ„ã€‚<code>å¦‚æœ Room æ— æ³•æ‰¾åˆ°å°†è¯¥è®¾å¤‡çš„æ•°æ®åº“ä»æ—§ç‰ˆæœ¬å‡çº§åˆ°å½“å‰ç‰ˆæœ¬çš„è¿ç§»è§„åˆ™</code>ï¼Œåˆ™ä¼šå‘ç”Ÿ <code>IllegalStateException</code>ã€‚<br>
è¦é˜²æ­¢åº”ç”¨åœ¨å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶å´©æºƒï¼Œè¯·åœ¨åˆ›å»ºæ•°æ®åº“æ—¶è°ƒç”¨ <code>fallbackToDestructiveMigration()</code> æ„å»ºå™¨æ–¹æ³•ï¼š</p>
</blockquote>
<br/>
<pre><code class="language-kotlin">    Room.databaseBuilder(applicationContext, MyDb::class.java, &quot;database-name&quot;)
            .fallbackToDestructiveMigration()
            .build()
</code></pre>
<p><strong>è­¦å‘Šï¼šé€šè¿‡åœ¨åº”ç”¨çš„æ•°æ®åº“æ„å»ºå™¨ä¸­é…ç½®æ­¤é€‰é¡¹ï¼ŒRoom ä¼šåœ¨ç¼ºå°‘è¿ç§»è·¯å¾„æ—¶<code>ä»æ•°æ®åº“è¡¨ä¸­æ°¸ä¹…åˆ é™¤æ‰€æœ‰æ•°æ®</code>ã€‚</strong></p>
<h2 id="ä½¿ç”¨-room-å¼•ç”¨å¤æ‚æ•°æ®">ä½¿ç”¨ Room å¼•ç”¨å¤æ‚æ•°æ®</h2>
<blockquote>
<p>Room æä¾›äº†åœ¨åŸºæœ¬ç±»å‹å’Œç›’è£…ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢çš„åŠŸèƒ½ï¼Œä½†ä¸å…è®¸å®ä½“ä¹‹é—´è¿›è¡Œå¯¹è±¡å¼•ç”¨ã€‚<br>
æœ‰æ—¶ï¼Œåº”ç”¨éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œå…¶ä¸­åŒ…å«æƒ³è¦å­˜å‚¨åˆ°å•ä¸ªæ•°æ®åº“åˆ—ä¸­çš„å€¼ã€‚è¦ä¸ºè‡ªå®šä¹‰ç±»å‹æ·»åŠ æ­¤ç±»æ”¯æŒï¼Œæ‚¨éœ€è¦æä¾›ä¸€ä¸ª <code>TypeConverter</code>ï¼Œå®ƒå¯ä»¥åœ¨<code>è‡ªå®šä¹‰ç±»</code>ä¸ <code>Room</code> å¯ä»¥ä¿ç•™çš„å·²çŸ¥ç±»å‹ä¹‹é—´æ¥å›è½¬æ¢ã€‚</p>
</blockquote>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä¿ç•™ Date çš„å®ä¾‹ï¼Œåˆ™å¯ä»¥ç¼–å†™ä»¥ä¸‹ TypeConverterï¼Œå°†ç­‰æ•ˆçš„ Unix æ—¶é—´æˆ³å­˜å‚¨åœ¨æ•°æ®åº“ä¸­</p>
<pre><code class="language-kotlin">    class Converters {
        @TypeConverter
        fun fromTimestamp(value: Long?): Date? {
            return value?.let { Date(it) }
        }

        @TypeConverter
        fun dateToTimestamp(date: Date?): Long? {
            return date?.time?.toLong()
        }
    }   
</code></pre>
<blockquote>
<p>å‰é¢çš„ç¤ºä¾‹å®šä¹‰äº† 2 ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªç”¨äº<code>å°† Date å¯¹è±¡è½¬æ¢ä¸º Long å¯¹è±¡</code>ï¼Œå¦ä¸€ä¸ªç”¨äºæ‰§è¡Œ<code>ä» Long åˆ° Date çš„åå‘è½¬æ¢</code>ã€‚<br>
ç”±äº Room å·²çŸ¥é“å¦‚ä½•ä¿ç•™ <code>Long</code> å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨æ­¤è½¬æ¢å™¨æ¥ä¿å­˜ <code>Date</code> ç±»å‹çš„å€¼ã€‚</p>
</blockquote>
<p>æ¥ç€ï¼Œå°† @TypeConverters æ³¨é‡Šæ·»åŠ åˆ° AppDatabase ç±»ä¸­ï¼Œä»¥ä¾¿ Room å¯ä»¥ä½¿ç”¨æ‚¨ä¸ºè¯¥ AppDatabase ä¸­çš„æ¯ä¸ªå®ä½“å’Œ DAO å®šä¹‰çš„è½¬æ¢å™¨ï¼š</p>
<pre><code class="language-kotlin">    @Database(entities = arrayOf(User::class), version = 1)
    @TypeConverters(Converters::class)
    abstract class AppDatabase : RoomDatabase() {
        abstract fun userDao(): UserDao
    }
    
    @Entity
    data class User(private val birthday: Date?)
    
    @Dao
    interface UserDao {
        @Query(&quot;SELECT * FROM user WHERE birthday BETWEEN :from AND :to&quot;)
        fun findUsersBornBetweenDates(from: Date, to: Date): List&lt;User&gt;
    }
</code></pre>
<p><strong>æ‚¨è¿˜å¯ä»¥å°† @TypeConverters é™åˆ¶ä¸ºä¸åŒçš„èŒƒå›´ï¼ŒåŒ…æ‹¬ä¸ªåˆ«å®ä½“ã€DAO å’Œ DAO æ–¹æ³•ã€‚</strong></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ”¶é›†å†Œ]]></title>
        <id>https://wl-go.github.io/post/shou-ji-ce/</id>
        <link href="https://wl-go.github.io/post/shou-ji-ce/">
        </link>
        <updated>2020-06-22T12:28:16.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>å¯¹å¹³æ—¶å¼€å‘ä¸­é‡åˆ°çš„ä¸€ä¸‹å°æŠ€å·§ã€å°çŸ¥è¯†ç‚¹çš„æ±‡æ€»è®°å½•ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥æ‰¾ğŸˆğŸ”¨âš™ğŸ‘€</p>
</blockquote>
<h2 id="androidæ·»åŠ å¿½ç•¥æ–‡ä»¶svn">Androidæ·»åŠ å¿½ç•¥æ–‡ä»¶(SVN)</h2>
<p>å¯ä»¥åœ¨<code>.idea/workspace.xml</code>ä¸­<code>&lt;component name=&quot;ChangeListManager&quot;&gt;</code>èŠ‚ç‚¹ä¸‹æ·»åŠ ä¸€ä¸‹å†…å®¹</p>
<pre><code class="language-Gradle">
&lt;ignored mask=&quot;*.iml&quot; /&gt;

&lt;ignored path=&quot;local.properties&quot; /&gt;

&lt;ignored path=&quot;.gradle/&quot; /&gt;

&lt;ignored path=&quot;.idea/&quot; /&gt;

&lt;ignored path=&quot;app/build/&quot; /&gt;

&lt;ignored path=&quot;build/&quot; /&gt;

&lt;ignored path=&quot;å…¶ä»–æ¨¡å—å/build/&quot; /&gt;    

&lt;ignored path=&quot;app/release/&quot; /&gt;
</code></pre>
<h2 id="è·å–android-keyçš„sha1">è·å–Android Keyçš„sha1</h2>
<pre><code class="language-bash">keytool -list -v -keystore C:\xxx.jks
</code></pre>
<h2 id="è·å–httpsè¯ä¹¦å­—ç¬¦ä¸²">è·å–httpsè¯ä¹¦å­—ç¬¦ä¸²</h2>
<pre><code class="language-bash">keytool -printcert -rfc -file c:\xxx.cer
</code></pre>
<h2 id="linux-æŸ¥ç«¯å£å ç”¨-æ€è¿›ç¨‹">Linux æŸ¥ç«¯å£å ç”¨ã€æ€è¿›ç¨‹</h2>
<pre><code class="language-bash">lsof -i tcp:8080  

kill -9 PID
</code></pre>
<h2 id="åç¼–è¯‘apk">åç¼–è¯‘APK</h2>
<pre><code class="language-bash">apktool d xxx.apk
apktool d -s xxx.apk (åªåç¼–è¯‘èµ„æº)

#ç”Ÿæˆapk
apktool b XXX 

#ç”Ÿæˆç­¾åkey
keytool -genkey -alias demo.keystore -keyalg RSA -validity 40000 -keystore demo.keystore 

#é‡æ–°æ‰“åŒ…
jarsigner -verbose -keystore demo.keystore -storepass 123456  -signedjar new.apk -digestalg SHA1 -sigalg MD5withRSA old.apk demo.keystore
</code></pre>
<h2 id="curl-ä½¿ç”¨get-post">Curl ä½¿ç”¨(GETã€POST)</h2>
<pre><code class="language-bash"># GET
curl -v 192.168.0.1:8080/xxx
	
# POST
curl -v 192.168.0.1:8080/xxx -d 'x1=1&amp;x2=2'
</code></pre>
<h2 id="é˜²æ­¢edittextå¼¹å‡ºé”®ç›˜åé¡¶èµ·å¸ƒå±€">é˜²æ­¢EditTextå¼¹å‡ºé”®ç›˜åé¡¶èµ·å¸ƒå±€</h2>
<ol>
<li>æ–¹æ³•ä¸€ï¼Œåœ¨oncreateä¸­åŠ å…¥</li>
</ol>
<pre><code>getWindow().setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_PAN);
</code></pre>
<ol start="2">
<li>æ–¹æ³•äºŒï¼Œåœ¨AndroidManifest.xmlä¸­åŠ å…¥</li>
</ol>
<pre><code> android:windowSoftInputMode=&quot;adjustPan|stateAlwaysHidden&quot;
</code></pre>
<h2 id="android-æµè§ˆå™¨sqliteæŸ¥çœ‹å·¥å…·">Android æµè§ˆå™¨SQLiteæŸ¥çœ‹å·¥å…·</h2>
<pre><code> debugCompile â€˜com.amitshekhar.android:debug-db:1.0.0â€™
</code></pre>
<h2 id="mac-å®‰è£…openjdk">Mac å®‰è£…OpenJDK</h2>
<pre><code class="language-bash">brew tap AdoptOpenJDK/openjdk
brew install &lt;version&gt; 
&lt;version&gt; å¯ä»¥é€‰æ‹©adoptopenjdk-openjdk8ã€adoptopenjdk-openjdk9ã€adoptopenjdk-openjdk10
</code></pre>
]]></content>
    </entry>
</feed>